#include "motor.h"

// Control Motor
void control_motor(uint8_t left_duty, uint8_t right_duty) {
	// Select IN Values
	select_IN_values(IN_values);

	// Enter IN Values to Motor driver
	enter_IN_values(IN_values);

	// Entr duty of Motor.
	enter_duty_of_motor(left_duty, right_duty);
}

// Select IN Values
void select_IN_values(uint8_t* IN_value) {
	if(receive_data[5] == 0) {
		if(receive_data[6] == 0) {
			IN_value[0] = GPIO_PIN_SET;
			IN_value[1] = GPIO_PIN_SET;
			IN_value[2] = GPIO_PIN_SET;
			IN_value[3] = GPIO_PIN_SET;
		}else if(receive_data[6] == 1) {
			IN_value[0] = GPIO_PIN_SET;
			IN_value[1] = GPIO_PIN_RESET;
			IN_value[2] = GPIO_PIN_SET;
			IN_value[3] = GPIO_PIN_RESET;
		}else if(receive_data[6] == 2) {
			IN_value[0] = GPIO_PIN_RESET;
			IN_value[1] = GPIO_PIN_SET;
			IN_value[2] = GPIO_PIN_RESET;
			IN_value[3] = GPIO_PIN_SET;
		}else if(receive_data[6] == 4) {
			IN_value[0] = GPIO_PIN_RESET;
			IN_value[1] = GPIO_PIN_SET;
			IN_value[2] = GPIO_PIN_SET;
			IN_value[3] = GPIO_PIN_RESET;
		}else if(receive_data[6] == 8) {
			IN_value[0] = GPIO_PIN_SET;
			IN_value[1] = GPIO_PIN_RESET;
			IN_value[2] = GPIO_PIN_RESET;
			IN_value[3] = GPIO_PIN_SET;
		}
	}
}

// Enter IN Values
void enter_IN_values(uint8_t* IN_value) {
	HAL_GPIO_WritePin(IN1_PORT, IN1_PIN, IN_value[0]);
	HAL_GPIO_WritePin(IN2_PORT, IN2_PIN, IN_value[1]);
	HAL_GPIO_WritePin(IN3_PORT, IN3_PIN, IN_value[2]);
	HAL_GPIO_WritePin(IN4_PORT, IN4_PIN, IN_value[3]);
}

// Enter Duty of Motor
void enter_duty_of_motor(uint8_t left_duty, uint8_t right_duty) {
	TIM1->CCR2 = left_duty;
	TIM3->CCR2 = right_duty;
}
